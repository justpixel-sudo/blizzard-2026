<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>2026 Northeast Blizzard — Snowfall Reports</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    /* iOS Safari fix: fill-available prevents toolbar overlap */
    html { height: -webkit-fill-available; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
      background: #060a14;
      color: #ddeeff;
      height: 100vh;
      height: 100dvh; /* dynamic viewport — correct on iOS */
      min-height: -webkit-fill-available;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    header {
      background: linear-gradient(135deg, #080e1c 0%, #0c1e3a 60%, #080e1c 100%);
      border-bottom: 1px solid #1a3050;
      padding: 14px 22px;
      display: flex;
      align-items: center;
      gap: 16px;
      flex-shrink: 0;
    }
    .flake { font-size: 2.2rem; animation: spin 20s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .header-text h1 {
      font-size: 1.35rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: #fff;
      text-shadow: 0 0 24px rgba(80, 160, 255, 0.6);
    }
    .header-text p { font-size: 0.72rem; color: #607090; margin-top: 2px; }
    .main { display: flex; flex: 1; overflow: hidden; min-height: 0; }

    /* ── SIDEBAR ── */
    .sidebar {
      width: 300px;
      background: #070b16;
      border-right: 1px solid #1a3050;
      overflow-y: auto;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex-shrink: 0;
    }
    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-thumb { background: #1a3050; border-radius: 2px; }

    .card {
      background: #0b1422;
      border: 1px solid #1a3050;
      border-radius: 10px;
      padding: 12px;
    }
    .card-title {
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #406080;
      margin-bottom: 10px;
    }

    /* Stats grid */
    .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .stat-item { text-align: center; }
    .stat-value { font-size: 1.7rem; font-weight: 800; color: #55aaff; line-height: 1; }
    .stat-label { font-size: 0.6rem; color: #3a5878; margin-top: 2px; }

    /* Filter tabs */
    .filter-row { display: flex; gap: 5px; flex-wrap: wrap; }
    .ftab {
      font-size: 0.64rem;
      padding: 4px 10px;
      background: #0b1422;
      border: 1px solid #1a3050;
      border-radius: 12px;
      cursor: pointer;
      color: #4a6888;
      transition: all 0.15s;
      user-select: none;
    }
    .ftab:hover { background: #122038; border-color: #305880; color: #80b0e0; }
    .ftab.active { background: #162c50; border-color: #4080c0; color: #90c0ff; font-weight: 600; }

    /* Legend */
    .legend-bar { height: 16px; border-radius: 4px; overflow: hidden; display: flex; margin-bottom: 5px; }
    .legend-bar div { flex: 1; }
    .legend-labels { display: flex; justify-content: space-between; font-size: 0.58rem; color: #3a5878; }

    /* Top list */
    .top-list { display: flex; flex-direction: column; gap: 3px; }
    .top-item {
      display: flex;
      align-items: center;
      gap: 7px;
      padding: 6px 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.12s;
      border: 1px solid transparent;
    }
    .top-item:hover { background: #101e34; border-color: #244060; }
    .rank { font-size: 0.58rem; color: #2a4a6a; width: 16px; text-align: right; flex-shrink: 0; }
    .top-snow { font-size: 0.95rem; font-weight: 700; width: 40px; flex-shrink: 0; }
    .top-loc { font-size: 0.68rem; color: #85aad0; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .top-tag { font-size: 0.58rem; color: #3a5878; flex-shrink: 0; }

    /* Map */
    #map { flex: 1; min-height: 0; min-width: 0; }

    /* Popup */
    .leaflet-popup-content-wrapper {
      background: #0c1828 !important;
      border: 1px solid #2a5080 !important;
      border-radius: 10px !important;
      color: #ddeeff !important;
      box-shadow: 0 4px 24px rgba(0,80,200,0.3) !important;
    }
    .leaflet-popup-tip-container { display: none; }
    .leaflet-popup-content { margin: 14px 16px !important; }
    .pu-loc { font-weight: 700; font-size: 0.9rem; color: #fff; margin-bottom: 2px; }
    .pu-snow { font-size: 2.2rem; font-weight: 900; line-height: 1; margin: 4px 0; }
    .pu-meta { font-size: 0.68rem; color: #5080a0; margin-top: 4px; line-height: 1.5; }

    /* ── MOBILE DRAWER TOGGLE ── */
    .drawer-btn {
      display: none;
      align-items: center;
      justify-content: space-between;
      background: #0a1424;
      border-top: 2px solid #1e3a5f;
      padding: 11px 18px;
      cursor: pointer;
      flex-shrink: 0;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      /* Safe area for iPhone home indicator */
      padding-bottom: calc(11px + env(safe-area-inset-bottom));
    }
    .drawer-mini-stats { display: flex; gap: 20px; }
    .drawer-mini-stat { text-align: center; }
    .drawer-mini-val { font-size: 1.15rem; font-weight: 800; color: #55aaff; line-height: 1; }
    .drawer-mini-lbl { font-size: 0.55rem; color: #3a5878; margin-top: 1px; }
    .drawer-label { font-size: 0.75rem; font-weight: 600; color: #6090c0; letter-spacing: 0.04em; }
    .drawer-arrow { font-size: 1.1rem; color: #4070a0; transition: transform 0.3s ease; line-height: 1; }
    .drawer-arrow.open { transform: rotate(180deg); }

    /* ── RESPONSIVE ── */
    @media (max-width: 768px) {
      header {
        padding: 10px 14px;
        padding-top: calc(10px + env(safe-area-inset-top));
        gap: 10px;
      }
      .flake { font-size: 1.6rem; }
      .header-text h1 { font-size: 0.95rem; }
      .header-text p { display: none; }

      .main { flex-direction: column; min-height: 0; }

      #map { order: 1; flex: 1; min-height: 0; width: 100%; }

      .drawer-btn { order: 2; display: flex; }

      .sidebar {
        order: 3;
        width: 100%;
        max-height: 0;
        overflow: hidden;
        border-right: none;
        border-top: none;
        padding: 0 14px;
        gap: 10px;
        transition: max-height 0.35s ease, padding 0.35s ease;
        /* smooth scrolling on iOS */
        -webkit-overflow-scrolling: touch;
      }
      .sidebar.mobile-open {
        max-height: 52dvh;
        max-height: 52vh; /* fallback */
        padding: 12px 14px;
        overflow-y: auto;
      }

      /* Bigger touch targets */
      .ftab { padding: 8px 14px; font-size: 0.73rem; }
      .top-item { padding: 9px 10px; }
      .top-loc { font-size: 0.73rem; }
      .top-snow { font-size: 1rem; width: 44px; }
      .stat-value { font-size: 1.5rem; }
      .card { padding: 10px; }
    }
  </style>
</head>
<body>

<header>
  <div class="flake">❄</div>
  <div class="header-text">
    <h1>2026 Northeast Blizzard — Snowfall Reports</h1>
    <p>February 23, 2026 · NWS New York (KOKX) · NOUS41 KOKX 240036 · Click any marker for details</p>
  </div>
</header>

<div class="main">
  <div class="sidebar">

    <!-- Storm overview -->
    <div class="card">
      <div class="card-title">Storm Overview</div>
      <div class="stat-grid">
        <div class="stat-item">
          <div class="stat-value" id="s-max">—</div>
          <div class="stat-label">Max (inches)</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="s-avg">—</div>
          <div class="stat-label">Avg (inches)</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="s-count">—</div>
          <div class="stat-label">Reports</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="s-over24">—</div>
          <div class="stat-label">Reports ≥ 24"</div>
        </div>
      </div>
    </div>

    <!-- State filter -->
    <div class="card">
      <div class="card-title">Filter by State</div>
      <div class="filter-row" id="state-tabs">
        <div class="ftab active" data-state="all">All States</div>
        <div class="ftab" data-state="CT">Connecticut</div>
        <div class="ftab" data-state="NJ">New Jersey</div>
        <div class="ftab" data-state="NY">New York</div>
      </div>
    </div>

    <!-- County filter -->
    <div class="card">
      <div class="card-title">Filter by County</div>
      <div class="filter-row" id="county-tabs"></div>
    </div>

    <!-- Color legend -->
    <div class="card">
      <div class="card-title">Snowfall Depth</div>
      <div class="legend-bar" id="legend-bar"></div>
      <div class="legend-labels">
        <span>0"</span><span>8"</span><span>16"</span><span>24"</span><span>32"</span>
      </div>
    </div>

    <!-- Top reports -->
    <div class="card">
      <div class="card-title">Top 20 Reports — click to fly there</div>
      <div class="top-list" id="top-list"></div>
    </div>

  </div>

  <div id="map"></div>

  <!-- Mobile bottom drawer toggle -->
  <div class="drawer-btn" id="drawer-btn">
    <div class="drawer-mini-stats">
      <div class="drawer-mini-stat">
        <div class="drawer-mini-val" id="dm-max">—</div>
        <div class="drawer-mini-lbl">Max inches</div>
      </div>
      <div class="drawer-mini-stat">
        <div class="drawer-mini-val" id="dm-count">—</div>
        <div class="drawer-mini-lbl">Reports</div>
      </div>
      <div class="drawer-mini-stat">
        <div class="drawer-mini-val" id="dm-over24">—</div>
        <div class="drawer-mini-lbl">≥ 24"</div>
      </div>
    </div>
    <span class="drawer-label">Filters & Rankings</span>
    <span class="drawer-arrow" id="drawer-arrow">▲</span>
  </div>

</div>

<script>
// ─── DATA ───────────────────────────────────────────────────────────────────────
// [lat, lon, snow_inches, location, county, state, provider]
const DATA = [
  // Connecticut — Fairfield
  [41.4313,-73.2631,12.0,"3 ENE Newtown","Fairfield","CT","Public"],
  [41.0924,-73.6527,13.0,"Greenwich","Fairfield","CT","Trained Spotter"],
  [41.3053,-73.1636,14.8,"3 WSW Shelton","Fairfield","CT",""],
  [41.2333,-73.2566,16.0,"3 E Easton","Fairfield","CT","Public"],
  [41.0282,-73.6192,16.0,"3 W Stamford","Fairfield","CT","Public"],
  [41.0821,-73.5525,16.0,"4 N Stamford","Fairfield","CT","Cocorahs"],
  [41.1482,-73.4627,16.5,"2 ENE New Canaan","Fairfield","CT","Trained Spotter"],
  [41.3715,-73.4116,17.0,"Bethel","Fairfield","CT","Emergency Mngr"],
  [41.4021,-73.4715,18.0,"Danbury","Fairfield","CT","Amateur Radio"],
  [41.0346,-73.6638,18.0,"4 S Greenwich","Fairfield","CT","Public"],
  [41.16,-73.13,20.0,"Bridgeport Airport","Fairfield","CT","Trained Spotter"],
  [41.5255,-73.4749,21.0,"4 NNW New Fairfield","Fairfield","CT","Trained Spotter"],
  // Connecticut — Middlesex
  [41.4758,-72.7046,16.0,"Durham","Middlesex","CT","COCORAHS"],
  [41.2758,-72.5301,17.0,"Clinton","Middlesex","CT","Broadcast Media"],
  [41.2756,-72.4615,17.0,"1 SW Westbrook","Middlesex","CT","Trained Spotter"],
  [41.2774,-72.4794,19.0,"1 WSW Westbrook","Middlesex","CT","Public"],
  // Connecticut — New Haven
  [41.3542,-73.0824,13.0,"1 NW Ansonia","New Haven","CT","Public"],
  [41.2737,-72.8211,14.7,"1 SW Branford","New Haven","CT","Trained Spotter"],
  [41.3543,-72.7005,16.0,"4 ENE North Branford","New Haven","CT","Trained Spotter"],
  [41.3859,-72.8347,16.0,"1 ENE North Haven","New Haven","CT","Trained Spotter"],
  [41.3076,-72.9274,16.1,"New Haven","New Haven","CT","Broadcast Media"],
  [41.4284,-73.1538,16.5,"2 WNW Oxford","New Haven","CT","Trained Spotter"],
  [41.2362,-73.08,17.5,"1 NW Milford","New Haven","CT","Public"],
  [41.2803,-72.677,18.0,"Guilford","New Haven","CT","CO-OP Observer"],
  [41.2513,-72.6996,18.0,"2 SSW Guilford","New Haven","CT","Public"],
  [41.2888,-72.757,18.5,"3 ENE Branford","New Haven","CT","Public"],
  [41.3851,-72.9211,19.0,"2 NW Hamden","New Haven","CT","Trained Spotter"],
  [41.276,-72.595,22.1,"Madison","New Haven","CT","Public"],
  // Connecticut — New London
  [41.6088,-71.9309,12.0,"Griswold","New London","CT","COCORAHS"],
  [41.3013,-72.2667,18.0,"Old Lyme","New London","CT","COCORAHS"],
  [41.5316,-72.0615,18.5,"2 SE Norwich","New London","CT","CO-OP Observer"],
  [41.4146,-72.0612,20.3,"3 SSE Gales Ferry","New London","CT","Trained Spotter"],
  [41.3491,-71.8451,20.5,"2 SSE Pawcatuck","New London","CT","Trained Spotter"],
  [41.343,-72.103,21.5,"1 SSW New London","New London","CT","Trained Spotter"],
  [41.3369,-71.9045,24.0,"4 ESE Mystic","New London","CT","Broadcast Media"],
  [41.3616,-71.9696,24.0,"1 N Mystic","New London","CT","Public"],
  [41.4223,-71.8845,30.8,"1 SSE North Stonington","New London","CT","Public"],
  // New Jersey — Bergen
  [40.7915,-74.1398,11.0,"North Arlington","Bergen","NJ","COCORAHS"],
  [40.9423,-74.0371,14.5,"1 SSW Oradell","Bergen","NJ","Cocorahs"],
  [41.0358,-74.0415,14.8,"Park Ridge","Bergen","NJ","Broadcast Media"],
  [41.0,-74.1677,15.0,"Mahwah","Bergen","NJ","Public"],
  [41.0522,-74.0491,15.0,"Montvale","Bergen","NJ","Emergency Mngr"],
  [40.9341,-74.0198,15.0,"New Milford","Bergen","NJ","Amateur Radio"],
  [40.9298,-74.1136,15.2,"Fair Lawn","Bergen","NJ","Trained Spotter"],
  [40.79,-74.127,16.0,"North Arlington","Bergen","NJ","Amateur Radio"],
  [41.0132,-74.0075,16.5,"River Vale","Bergen","NJ","Trained Spotter"],
  [40.9217,-74.1042,17.0,"1 SE Fair Lawn","Bergen","NJ","Public"],
  [41.034,-74.0025,17.0,"1 N River Vale","Bergen","NJ","Trained Spotter"],
  [40.8457,-74.0395,17.5,"Little Ferry","Bergen","NJ","Amateur Radio"],
  [40.9177,-74.0426,17.5,"1 SSW River Edge","Bergen","NJ","Cocorahs"],
  [40.8508,-74.1179,17.9,"1 WSW Wallington","Bergen","NJ","Trained Spotter"],
  [40.9859,-74.0181,18.0,"1 ESE Westwood","Bergen","NJ","Trained Spotter"],
  [41.0107,-73.9528,19.0,"Northvale","Bergen","NJ","Public"],
  [40.9385,-73.9573,19.5,"Cresskill","Bergen","NJ","Public"],
  [41.0775,-74.1638,20.1,"2 NW Ramsey","Bergen","NJ","Public"],
  [40.9922,-74.2205,21.2,"1 SSW Franklin Lakes","Bergen","NJ","Public"],
  [40.8481,-74.0002,21.8,"Palisades Park","Bergen","NJ","COCORAHS"],
  [41.0274,-74.2284,22.0,"1 ESE Oakland","Bergen","NJ","Public"],
  [40.9796,-73.9573,22.4,"1 NNE Closter","Bergen","NJ","Public"],
  [40.8553,-74.0823,22.5,"Wood-Ridge","Bergen","NJ","Public"],
  [40.9912,-73.9764,23.0,"Harrington Park","Bergen","NJ","Public"],
  [40.9316,-73.9949,23.8,"1 NNE Bergenfield","Bergen","NJ","Trained Spotter"],
  [40.9321,-74.0354,24.0,"River Edge","Bergen","NJ","COCORAHS"],
  [40.9215,-73.9495,24.2,"Tenafly","Bergen","NJ",""],
  [40.8416,-74.067,24.3,"Moonachie","Bergen","NJ","Public"],
  [40.8057,-73.9926,24.5,"1 SSE Fairview","Bergen","NJ","Public"],
  [40.8504,-73.9713,26.0,"Fort Lee","Bergen","NJ","Amateur Radio"],
  [40.9613,-73.9992,26.4,"Haworth","Bergen","NJ","Public"],
  [40.8304,-74.0103,27.1,"Ridgefield","Bergen","NJ","Public"],
  [40.8959,-73.9833,27.5,"1 WNW Englewood","Bergen","NJ","Public"],
  [40.9708,-73.9832,27.6,"1 NE Haworth","Bergen","NJ","Public"],
  [40.878,-74.0294,29.5,"Bogota","Bergen","NJ","Public"],
  [40.8617,-73.9879,29.7,"Leonia","Bergen","NJ","Public"],
  [40.8303,-74.059,30.2,"Carlstadt","Bergen","NJ","Public"],
  [40.8027,-74.1229,30.7,"1 NW Lyndhurst","Bergen","NJ","Public"],
  // New Jersey — Essex
  [40.8188,-74.1572,12.0,"Nutley","Essex","NJ","Amateur Radio"],
  [40.8615,-74.2775,12.3,"West Caldwell","Essex","NJ","COCORAHS"],
  [40.8326,-74.2583,14.2,"Verona","Essex","NJ","COCORAHS"],
  [40.8429,-74.2039,15.0,"1 NNE Montclair","Essex","NJ","Public"],
  [40.8457,-74.2268,16.0,"1 S Cedar Grove","Essex","NJ","Public"],
  [40.7384,-74.3272,16.0,"Millburn","Essex","NJ","Amateur Radio"],
  [40.7732,-74.2735,16.0,"1 SSW West Orange","Essex","NJ","Public"],
  [40.8106,-74.1869,17.0,"Bloomfield","Essex","NJ","Amateur Radio"],
  [40.8169,-74.2001,17.0,"1 SE Montclair","Essex","NJ","Public"],
  [40.8634,-74.2591,17.0,"North Caldwell","Essex","NJ","Amateur Radio"],
  [40.8561,-74.2689,17.0,"1 SW North Caldwell","Essex","NJ","Public"],
  [40.8093,-74.1527,17.0,"1 SSE Nutley","Essex","NJ","Public"],
  [40.8285,-74.2902,18.5,"1 W Essex Fells","Essex","NJ","Public"],
  [40.7954,-74.2298,19.0,"1 WSW Glen Ridge","Essex","NJ","Public"],
  [40.7362,-74.1891,25.8,"1 NW Newark","Essex","NJ","Public"],
  [40.7682,-74.2364,26.0,"Orange","Essex","NJ","Amateur Radio"],
  // New Jersey — Hudson
  [40.7432,-74.1559,18.0,"Harrison","Hudson","NJ","CO-OP Observer"],
  [40.7513,-74.1197,19.0,"Kearny","Hudson","NJ","Trained Spotter"],
  [40.7439,-74.0286,20.5,"Hoboken","Hudson","NJ","Trained Spotter"],
  // New Jersey — Passaic
  [40.8573,-74.1294,14.0,"Passaic","Passaic","NJ","Amateur Radio"],
  [40.9369,-74.2515,14.1,"Wayne","Passaic","NJ","COCORAHS"],
  [40.8906,-74.1877,15.0,"West Paterson","Passaic","NJ","Public"],
  [40.9092,-74.2241,16.0,"Totowa","Passaic","NJ","Public"],
  [40.9626,-74.2269,18.5,"2 NE Wayne","Passaic","NJ","Public"],
  // New Jersey — Union
  [40.6111,-74.3195,14.9,"Clark","Union","NJ","COCORAHS"],
  [40.6917,-74.3214,17.0,"1 SSE Springfield","Union","NJ","Public"],
  [40.6261,-74.2897,18.5,"Clark","Union","NJ","COCORAHS"],
  [40.6924,-74.3266,19.3,"Springfield","Union","NJ","Public"],
  [40.6366,-74.3508,20.0,"1 SSW Westfield","Union","NJ","Public"],
  [40.669,-74.3198,21.0,"1 NW Cranford","Union","NJ","Trained Spotter"],
  [40.68,-74.17,27.2,"Newark Airport","Union","NJ","Official NWS Obs"],
  // New York — Bronx
  [40.8502,-73.8253,14.8,"1 SSW Co-Op City","Bronx","NY","Public"],
  [40.8175,-73.8201,20.9,"1 W Throgs Neck","Bronx","NY","Trained Spotter"],
  [40.8738,-73.8854,22.6,"Fordham","Bronx","NY","Public"],
  [40.8294,-73.9064,23.4,"1 NNE Mott Haven","Bronx","NY","Public"],
  // New York — Kings (Brooklyn)
  [40.5757,-73.9631,18.0,"1 ESE Coney Island","Kings","NY","Public"],
  [40.6989,-73.989,19.1,"1 SE Battery Park","Kings","NY","Emergency Mngr"],
  [40.6681,-73.9488,21.0,"Crown Heights","Kings","NY","Public"],
  [40.6976,-73.9515,21.1,"1 SSE Williamsburg","Kings","NY","Public"],
  [40.6003,-73.9489,22.5,"Sheepshead Bay","Kings","NY","Trained Spotter"],
  // New York — Nassau
  [40.784,-73.5197,15.2,"1 ESE Jericho","Nassau","NY","Trained Spotter"],
  [40.8499,-73.6451,15.8,"Sea Cliff","Nassau","NY","Trained Spotter"],
  [40.83,-73.5036,16.3,"1 N Syosset","Nassau","NY","Trained Spotter"],
  [40.7562,-73.6365,16.9,"East Williston","Nassau","NY","Public"],
  [40.7594,-73.6008,18.0,"1 W Westbury","Nassau","NY","Amateur Radio"],
  [40.6699,-73.6645,18.5,"1 SE Malverne","Nassau","NY","Public"],
  [40.8745,-73.6266,19.0,"1 ENE Glen Cove","Nassau","NY","Public"],
  [40.717,-73.5333,19.0,"1 WSW Levittown","Nassau","NY","NWS Employee"],
  [40.6459,-73.5222,20.0,"Bellmore","Nassau","NY","COCORAHS"],
  [40.6459,-73.5221,21.0,"1 SSE Bellmore","Nassau","NY","Public"],
  [40.6973,-73.7184,21.5,"1 SW Elmont","Nassau","NY","Trained Spotter"],
  [40.6686,-73.5236,22.0,"1 W Wantagh","Nassau","NY","Amateur Radio"],
  [40.654,-73.4766,22.4,"1 SSW South Massapequa","Nassau","NY","Cocorahs"],
  [40.7866,-73.483,23.0,"1 WNW Plainview","Nassau","NY","Trained Spotter"],
  [40.7677,-73.4564,23.2,"1 SE Plainview","Nassau","NY","Public"],
  [40.7285,-73.5424,23.7,"1 NE East Meadow","Nassau","NY","Emergency Mngr"],
  [40.782,-73.4709,23.8,"Plainview","Nassau","NY","Public"],
  [40.6577,-73.6741,24.0,"Lynbrook","Nassau","NY","Amateur Radio"],
  [40.7622,-73.4948,24.4,"1 NNW Bethpage","Nassau","NY","Public"],
  [40.6738,-73.4402,24.4,"East Massapequa","Nassau","NY","Public"],
  [40.6825,-73.4417,24.5,"1 NNW East Massapequa","Nassau","NY","Public"],
  [40.6977,-73.5476,25.4,"1 ENE North Merrick","Nassau","NY","Public"],
  // New York — Manhattan
  [40.825,-73.9477,15.0,"1 W Harlem","New York","NY","Trained Spotter"],
  [40.78,-73.97,19.7,"Central Park","New York","NY","Official NWS Obs"],
  [40.745,-74.0013,20.4,"Greenwich Village","New York","NY","Public"],
  [40.714,-73.9759,22.2,"1 WNW Williamsburg","New York","NY","Public"],
  [40.8494,-73.9283,22.8,"Washington Heights","New York","NY",""],
  // New York — Orange
  [41.4011,-74.3275,6.0,"Goshen","Orange","NY","Public"],
  [41.3599,-74.6409,6.2,"Port Jervis","Orange","NY","COCORAHS"],
  [41.4696,-74.113,9.0,"2 SSW Stewart Airport","Orange","NY","Public"],
  [41.2684,-74.416,9.6,"Warwick","Orange","NY","COCORAHS"],
  [41.2686,-74.4163,10.8,"3 WNW Warwick","Orange","NY","Trained Spotter"],
  [41.4469,-74.0214,11.0,"Cornwall On Hudson","Orange","NY","COCORAHS"],
  [41.2993,-74.2606,12.5,"4 SSE Chester","Orange","NY","COCORAHS"],
  [41.417,-74.1749,13.0,"1 SW Washingtonville","Orange","NY","Public"],
  [41.189,-74.3265,13.5,"Greenwood Lake","Orange","NY","COCORAHS"],
  [41.3206,-74.1863,13.5,"Monroe","Orange","NY","Trained Spotter"],
  [41.2078,-74.3126,14.9,"2 SW Greenwood Lake","Orange","NY","Public"],
  [41.3531,-74.0933,15.3,"2 E Highland Mills","Orange","NY","Public"],
  [41.3271,-74.212,15.3,"1 WNW Monroe","Orange","NY","Trained Spotter"],
  [41.2143,-74.2974,18.0,"1 SW Greenwood Lake","Orange","NY","Public"],
  // New York — Putnam
  [41.4807,-73.8911,10.0,"Cold Spring","Putnam","NY","COCORAHS"],
  [41.4246,-73.9477,10.0,"Nelsonville","Putnam","NY","COCORAHS"],
  [41.3845,-73.8642,12.1,"3 N Putnam Valley","Putnam","NY","Broadcast Media"],
  [41.337,-73.9041,18.8,"2 W Putnam Valley","Putnam","NY","Public"],
  // New York — Queens
  [40.7728,-73.7381,13.5,"1 SW Russell Gardens","Queens","NY","Trained Spotter"],
  [40.6621,-73.8413,17.0,"Howard Beach","Queens","NY","COCORAHS"],
  [40.7566,-73.9084,18.0,"2 S Astoria","Queens","NY","Public"],
  [40.64,-73.76,20.1,"NYC/JFK Airport","Queens","NY","Official NWS Obs"],
  [40.7682,-73.888,20.2,"Jackson Heights","Queens","NY","Trained Spotter"],
  [40.7137,-73.9072,20.3,"2 SW Elmhurst","Queens","NY","Trained Spotter"],
  [40.6941,-73.7908,21.0,"1 S Jamaica","Queens","NY","Public"],
  [40.6621,-73.8414,22.0,"Howard Beach","Queens","NY","Trained Spotter"],
  [40.78,-73.88,22.5,"NYC/LaGuardia Airport","Queens","NY","Official NWS Obs"],
  [40.7884,-73.8193,23.0,"Whitestone","Queens","NY","Public"],
  // New York — Richmond (Staten Island)
  [40.5795,-74.1562,21.3,"1 ESE Heartland Village","Richmond","NY","Public"],
  [40.5674,-74.1327,22.0,"Staten Island Willowbrook","Richmond","NY","COCORAHS"],
  [40.61,-74.07,24.1,"Grasmere","Richmond","NY","Public"],
  [40.5661,-74.1072,24.3,"2 S New Dorp","Richmond","NY","Public"],
  [40.5906,-74.0902,27.0,"Dongan Hills","Richmond","NY","Public"],
  [40.6147,-74.1204,27.8,"1 ENE Todt Hill","Richmond","NY","Public"],
  [40.6043,-74.0838,29.0,"1 WSW Grasmere","Richmond","NY","Public"],
  // New York — Rockland
  [41.235,-74.0079,10.3,"1 NW Stony Point","Rockland","NY","Cocorahs"],
  [41.2076,-74.0105,12.0,"Thiells","Rockland","NY","Amateur Radio"],
  [41.1406,-74.0327,12.9,"New Square","Rockland","NY","Public"],
  [41.0457,-74.0072,13.9,"1 SSW Pearl River","Rockland","NY","Trained Spotter"],
  [41.1124,-74.0795,14.1,"1 WSW Monsey","Rockland","NY","Public"],
  [41.0917,-74.0593,14.5,"Spring Valley SSW","Rockland","NY","COCORAHS"],
  [41.1538,-73.9918,15.9,"New City","Rockland","NY","Amateur Radio"],
  [41.1354,-74.0676,16.0,"1 ENE Viola","Rockland","NY","Public"],
  [41.095,-73.9152,17.0,"Nyack","Rockland","NY",""],
  [41.1178,-74.0461,18.0,"Spring Valley","Rockland","NY","Public"],
  [41.1236,-74.0493,19.2,"1 N Spring Valley","Rockland","NY","Public"],
  // New York — Suffolk
  [40.8777,-73.3525,11.3,"1 NE Greenlawn","Suffolk","NY","Public"],
  [40.943,-73.1381,13.5,"Setauket-East Setauket","Suffolk","NY","COCORAHS"],
  [40.7514,-73.1884,15.0,"Islip Terrace","Suffolk","NY","Trained Spotter"],
  [40.8965,-73.3428,15.0,"1 SSE Northport","Suffolk","NY","Trained Spotter"],
  [40.7516,-73.1885,15.5,"Islip Terrace NNW","Suffolk","NY","COCORAHS"],
  [40.8854,-73.3739,16.0,"1 S Centerport","Suffolk","NY","CO-OP Observer"],
  [40.6765,-73.3897,16.5,"Copiague","Suffolk","NY","Public"],
  [40.948,-72.5844,16.6,"1 WNW Jamesport","Suffolk","NY","Public"],
  [40.9559,-72.9356,17.0,"1 NW Rocky Point","Suffolk","NY","Public"],
  [40.8764,-73.2135,17.1,"1 N Smithtown","Suffolk","NY","Trained Spotter"],
  [40.7569,-72.9421,18.0,"Bellport","Suffolk","NY","Trained Spotter"],
  [40.6951,-73.358,18.0,"Lindenhurst NE","Suffolk","NY","COCORAHS"],
  [40.6772,-73.4103,19.0,"Amityville","Suffolk","NY","COCORAHS"],
  [40.8497,-73.2694,19.0,"1 ENE Commack","Suffolk","NY","Trained Spotter"],
  [40.8958,-72.8539,19.6,"2 SE Ridge","Suffolk","NY","Trained Spotter"],
  [40.9292,-72.6711,19.7,"3 WNW Riverhead","Suffolk","NY","Cocorahs"],
  [40.9055,-73.1301,19.7,"Stony Brook","Suffolk","NY","Trained Spotter"],
  [40.87,-72.86,19.8,"Upton NWS Office","Suffolk","NY","Official NWS Obs"],
  [40.7616,-72.9656,20.0,"1 ESE East Patchogue","Suffolk","NY","NWS Employee"],
  [40.829,-73.1643,20.0,"Nesconset","Suffolk","NY","COCORAHS"],
  [40.9289,-72.6715,20.2,"3 WNW Riverhead","Suffolk","NY","NWS Employee"],
  [40.7377,-73.1342,20.5,"Oakdale","Suffolk","NY","Trained Spotter"],
  [40.9191,-72.8508,20.7,"2 ENE Ridge","Suffolk","NY","Trained Spotter"],
  [40.8666,-73.3121,21.0,"1 SE East Northport","Suffolk","NY","Public"],
  [41.0588,-72.3602,21.1,"1 SW Shelter Island","Suffolk","NY","Amateur Radio"],
  [40.8607,-72.8013,22.0,"Manorville","Suffolk","NY","Public"],
  [40.7089,-73.2966,22.8,"West Islip","Suffolk","NY","Trained Spotter"],
  [40.9113,-72.5628,23.0,"2 E Flanders","Suffolk","NY","Public"],
  [40.8138,-73.1964,23.0,"1 ESE Hauppauge","Suffolk","NY","Public"],
  [40.7406,-73.1873,23.0,"1 S Islip Terrace","Suffolk","NY","Trained Spotter"],
  [40.7472,-73.1966,23.0,"Islip Terrace W","Suffolk","NY","COCORAHS"],
  [40.8452,-73.0903,23.0,"1 NE Lake Ronkonkoma","Suffolk","NY","NWS Employee"],
  [40.8656,-72.9642,23.0,"2 SW Middle Island","Suffolk","NY",""],
  [40.8608,-73.0188,23.0,"Selden","Suffolk","NY","COCORAHS"],
  [40.9916,-72.5407,23.3,"Mattituck","Suffolk","NY","Trained Spotter"],
  [40.8208,-73.1642,23.5,"1 NNE Islandia","Suffolk","NY","Public"],
  [40.6958,-73.3257,24.0,"Babylon","Suffolk","NY","Amateur Radio"],
  [40.9298,-72.8989,24.0,"2 NNW Ridge","Suffolk","NY","Trained Spotter"],
  [40.9001,-72.4178,24.0,"2 NW Southampton","Suffolk","NY","Public"],
  [40.6647,-73.0709,24.2,"4 WSW Davis Park","Suffolk","NY","Public"],
  [40.6857,-73.3718,24.3,"Lindenhurst","Suffolk","NY","Public"],
  [40.7234,-73.241,24.7,"Bay Shore","Suffolk","NY","COCORAHS"],
  [40.7065,-73.3865,25.0,"2 NNW Lindenhurst","Suffolk","NY","Fire Dept/Rescue"],
  [40.9068,-72.4211,25.0,"2 ENE Shinnecock Hills","Suffolk","NY",""],
  [40.7534,-73.2299,25.3,"2 NNW Islip","Suffolk","NY","Public"],
  [40.838,-72.5892,26.0,"1 SSE Quogue","Suffolk","NY","Public"],
  [40.8867,-72.3895,26.0,"1 NE Southampton","Suffolk","NY","Public"],
  [41.1321,-72.2584,26.5,"Orient Point","Suffolk","NY","COOP"],
  [40.8911,-73.2839,27.2,"Fort Salonga","Suffolk","NY","COCORAHS"],
  [40.7103,-73.3928,27.5,"2 SE East Farmingdale","Suffolk","NY","Trained Spotter"],
  [40.8122,-72.7039,27.5,"Remsenburg-Speonk","Suffolk","NY","Public"],
  [40.8506,-72.9855,27.8,"2 N Medford","Suffolk","NY","Trained Spotter"],
  [41.0483,-71.9459,28.1,"Montauk","Suffolk","NY","Public"],
  [40.7264,-73.2505,28.2,"Bay Shore","Suffolk","NY","NWS Employee"],
  [40.822,-72.8875,28.5,"1 W Shirley Airport","Suffolk","NY","Public"],
  [40.847,-73.1636,28.8,"1 W Nesconset","Suffolk","NY",""],
  [40.7961,-73.0852,29.0,"1 WNW Holbrook","Suffolk","NY","Public"],
  [40.7328,-73.2177,29.1,"Islip","Suffolk","NY","Official NWS Obs"],
  [40.6892,-73.3346,29.5,"1 SW Babylon","Suffolk","NY","Amateur Radio"],
  [40.7349,-73.1924,30.0,"1 NNW East Islip","Suffolk","NY","Fire Dept/Rescue"],
  [40.7886,-73.018,30.0,"North Patchogue","Suffolk","NY","Public"],
  [40.7805,-73.1963,31.0,"Central Islip","Suffolk","NY","Trained Spotter"],
  // New York — Westchester
  [41.3324,-73.837,11.0,"Shrub Oak","Westchester","NY","COCORAHS"],
  [40.9162,-73.7603,11.2,"New Rochelle","Westchester","NY","COCORAHS"],
  [41.3283,-73.9091,12.0,"Peekskill","Westchester","NY","COCORAHS"],
  [41.2848,-73.5528,14.0,"South Salem","Westchester","NY","COCORAHS"],
  [41.013,-73.7402,14.7,"1 ESE White Plains","Westchester","NY","Trained Spotter"],
  [41.0209,-73.7574,15.0,"White Plains","Westchester","NY","Amateur Radio"],
  [40.9232,-73.7799,15.6,"New Rochelle","Westchester","NY","Trained Spotter"],
  [41.2803,-73.9293,16.0,"1 SSW Peekskill","Westchester","NY","Trained Spotter"],
  [40.9449,-73.8503,16.0,"1 E Yonkers","Westchester","NY","Public"],
  [40.9881,-73.7632,16.3,"1 E Scarsdale","Westchester","NY","Public"],
  [40.9345,-73.7274,16.5,"Mamaroneck","Westchester","NY","Amateur Radio"],
  [41.0415,-73.742,17.0,"2 NNE White Plains","Westchester","NY","Trained Spotter"],
  [41.2801,-73.7803,17.0,"1 N Yorktown Heights","Westchester","NY","Public"],
  [40.9705,-73.7876,18.0,"1 NE Eastchester","Westchester","NY","Public"],
  [40.9562,-73.719,18.0,"2 NNE Mamaroneck","Westchester","NY","Public"],
  [41.1888,-73.8132,18.0,"4 NE Ossining","Westchester","NY","Public"],
  [41.2672,-73.8735,18.0,"3 ESE Peekskill","Westchester","NY","Public"],
  [41.1043,-73.864,18.0,"1 NNE Sleepy Hollow","Westchester","NY","Public"],
  [41.0327,-73.7663,18.0,"1 NNW White Plains","Westchester","NY","Public"],
  [41.2866,-73.7939,18.0,"1 NNW Yorktown Heights","Westchester","NY","Public"],
  [40.8924,-73.7856,18.1,"1 E Pelham Manor","Westchester","NY","Public"],
  [41.2747,-73.9262,18.3,"1 S Peekskill","Westchester","NY","Public"],
  [40.9142,-73.8268,18.8,"Mount Vernon","Westchester","NY","Public"],
  [41.006,-73.8471,20.0,"1 SSW Ardsley","Westchester","NY","Public"],
  [41.1981,-73.8818,20.0,"1 SE Croton-on-Hudson","Westchester","NY","Public"],
  [41.0234,-73.7946,20.0,"1 ESE Hartsdale","Westchester","NY","Public"],
  [41.0895,-73.8419,20.1,"2 E Sleepy Hollow","Westchester","NY","Public"],
  [41.1585,-73.8715,21.3,"Ossining","Westchester","NY","Amateur Radio"],
  [41.2091,-73.8868,21.5,"Croton-on-Hudson","Westchester","NY","Public"],
  [41.0446,-73.7705,21.5,"2 NNW White Plains","Westchester","NY","Trained Spotter"],
  [41.2125,-73.8819,22.0,"1 NE Croton-on-Hudson","Westchester","NY","Public"],
  [41.2596,-73.7706,22.0,"1 SE Yorktown Heights","Westchester","NY","Public"],
  [41.1628,-73.842,22.5,"2 E Ossining","Westchester","NY","Public"],
  [41.0497,-73.8501,23.0,"1 NE Irvington","Westchester","NY","Public"],
  [41.2753,-73.7735,23.0,"1 ENE Yorktown Heights","Westchester","NY","Public"],
  [41.186,-73.8543,23.2,"2 NNE Ossining","Westchester","NY","Public"],
  [41.1772,-73.5905,23.5,"3 ESE Bedford","Westchester","NY","Public"],
  [40.9183,-73.8746,23.5,"2 NW Woodlawn","Westchester","NY","Trained Spotter"],
  [41.021,-73.7962,24.0,"1 SE Hartsdale","Westchester","NY","Trained Spotter"],
  [41.0698,-73.7783,24.0,"1 S Valhalla","Westchester","NY","Public"],
  [40.9845,-73.8277,24.1,"1 SSW Greenville","Westchester","NY","Public"],
];

// ─── COLOR INTERPOLATION ────────────────────────────────────────────────────────
function hexToRgb(hex) {
  return [parseInt(hex.slice(1,3),16), parseInt(hex.slice(3,5),16), parseInt(hex.slice(5,7),16)];
}
function rgbToHex([r,g,b]) {
  return '#'+[r,g,b].map(v=>Math.round(v).toString(16).padStart(2,'0')).join('');
}
const SCALE = [
  [0,  '#cceeff'],
  [6,  '#88ddff'],
  [10, '#44bbff'],
  [14, '#0099ff'],
  [18, '#0066dd'],
  [22, '#0033bb'],
  [26, '#5500cc'],
  [29, '#9900dd'],
  [31, '#dd00ff'],
  [33, '#ff44cc'],
];
function snowColor(v) {
  for (let i = 0; i < SCALE.length - 1; i++) {
    if (v >= SCALE[i][0] && v < SCALE[i+1][0]) {
      const t = (v - SCALE[i][0]) / (SCALE[i+1][0] - SCALE[i][0]);
      const [r1,g1,b1] = hexToRgb(SCALE[i][1]);
      const [r2,g2,b2] = hexToRgb(SCALE[i+1][1]);
      return rgbToHex([r1+(r2-r1)*t, g1+(g2-g1)*t, b1+(b2-b1)*t]);
    }
  }
  return SCALE[SCALE.length-1][1];
}

// ─── MAP INIT ──────────────────────────────────────────────────────────────────
const map = L.map('map', { center:[40.9,-73.2], zoom:9, preferCanvas:true });
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution:'&copy; OpenStreetMap &copy; CARTO',
  subdomains:'abcd', maxZoom:20
}).addTo(map);

let markers = [];

function buildMarkers(subset) {
  markers.forEach(m => m.circle.remove());
  markers = [];
  subset.forEach(d => {
    const [lat,lon,snow,loc,county,state,prov] = d;
    const col = snowColor(snow);
    const r   = Math.max(5, snow * 0.65);
    const extreme = snow >= 29;
    const c = L.circleMarker([lat,lon], {
      radius: r,
      fillColor: col,
      color: extreme ? '#ffffff' : col,
      weight: extreme ? 1.5 : 0.5,
      opacity: extreme ? 0.9 : 0.6,
      fillOpacity: extreme ? 0.88 : 0.72,
    });
    c.bindPopup(`
      <div class="pu-loc">${loc}</div>
      <div class="pu-snow" style="color:${col}">${snow.toFixed(1)}"</div>
      <div class="pu-meta">
        ${county} County, ${state}<br>
        ${prov || 'Source unspecified'}
      </div>
    `, { maxWidth:220, closeButton:false });
    c.addTo(map);
    markers.push({ circle:c, data:d });
  });
}

// ─── STATS & TOP LIST ──────────────────────────────────────────────────────────
function refresh(subset) {
  buildMarkers(subset);
  const snows = subset.map(d=>d[2]);
  const max   = Math.max(...snows);
  const avg   = snows.reduce((a,b)=>a+b,0)/snows.length;
  const o24   = snows.filter(s=>s>=24).length;
  document.getElementById('s-max').textContent    = max.toFixed(1);
  document.getElementById('s-avg').textContent    = avg.toFixed(1);
  document.getElementById('s-count').textContent  = subset.length;
  document.getElementById('s-over24').textContent = o24;
  // mobile mini-stats
  document.getElementById('dm-max').textContent   = max.toFixed(1);
  document.getElementById('dm-count').textContent = subset.length;
  document.getElementById('dm-over24').textContent = o24;

  const top = [...subset].sort((a,b)=>b[2]-a[2]).slice(0,20);
  const list = document.getElementById('top-list');
  list.innerHTML = '';
  top.forEach((d,i) => {
    const [lat,lon,snow,loc,county,state] = d;
    const el = document.createElement('div');
    el.className = 'top-item';
    el.innerHTML = `
      <span class="rank">#${i+1}</span>
      <span class="top-snow" style="color:${snowColor(snow)}">${snow.toFixed(1)}"</span>
      <span class="top-loc">${loc}</span>
      <span class="top-tag">${county.slice(0,8)}, ${state}</span>
    `;
    el.addEventListener('click', () => {
      map.setView([lat,lon],13);
      markers.find(m=>m.data===d)?.circle.openPopup();
    });
    list.appendChild(el);
  });
}

// ─── FILTER STATE ──────────────────────────────────────────────────────────────
let activeState  = 'all';
let activeCounty = 'all';

// All counties grouped by state, in display order
const COUNTY_MAP = {
  CT: ['Fairfield','Middlesex','New Haven','New London'],
  NJ: ['Bergen','Essex','Hudson','Passaic','Union'],
  NY: ['Bronx','Kings','Nassau','New York','Orange','Putnam','Queens','Richmond','Rockland','Suffolk','Westchester'],
};

function getSubset() {
  return DATA.filter(d => {
    const stateOk  = activeState  === 'all' || d[5] === activeState;
    const countyOk = activeCounty === 'all' || d[4] === activeCounty;
    return stateOk && countyOk;
  });
}

function zoomToSubset(sub) {
  if (sub.length === 0) return;
  const lats = sub.map(d=>d[0]), lons = sub.map(d=>d[1]);
  map.fitBounds([[Math.min(...lats),Math.min(...lons)],[Math.max(...lats),Math.max(...lons)]], {padding:[40,40]});
}

function buildCountyTabs(state) {
  const container = document.getElementById('county-tabs');
  container.innerHTML = '';

  const counties = state === 'all'
    ? [...new Set(DATA.map(d=>d[4]))].sort()
    : (COUNTY_MAP[state] || []);

  // "All" tab
  const allTab = document.createElement('div');
  allTab.className = 'ftab active';
  allTab.textContent = 'All';
  allTab.dataset.county = 'all';
  container.appendChild(allTab);

  counties.forEach(county => {
    const t = document.createElement('div');
    t.className = 'ftab';
    t.textContent = county === 'New York' ? 'Manhattan' : county;
    t.dataset.county = county;
    container.appendChild(t);
  });

  // Attach county click handlers
  container.querySelectorAll('.ftab').forEach(tab => {
    tab.addEventListener('click', () => {
      container.querySelectorAll('.ftab').forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      activeCounty = tab.dataset.county;
      const sub = getSubset();
      refresh(sub);
      if (activeCounty !== 'all') zoomToSubset(sub);
      else if (activeState !== 'all') zoomToSubset(DATA.filter(d=>d[5]===activeState));
      else map.setView([40.9,-73.2],9);
    });
  });
}

// Init county tabs for "all states"
buildCountyTabs('all');
refresh(DATA);

// ─── STATE FILTER ──────────────────────────────────────────────────────────────
document.getElementById('state-tabs').querySelectorAll('.ftab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.getElementById('state-tabs').querySelectorAll('.ftab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    activeState  = tab.dataset.state;
    activeCounty = 'all';          // reset county when state changes
    buildCountyTabs(activeState);
    const sub = getSubset();
    refresh(sub);
    if (activeState !== 'all') zoomToSubset(sub);
    else map.setView([40.9,-73.2],9);
  });
});

// ─── MOBILE DRAWER ─────────────────────────────────────────────────────────────
const drawerBtn   = document.getElementById('drawer-btn');
const drawerArrow = document.getElementById('drawer-arrow');
const sidebar     = document.querySelector('.sidebar');
drawerBtn.addEventListener('click', () => {
  sidebar.classList.toggle('mobile-open');
  drawerArrow.classList.toggle('open');
});
// Close drawer when a top-list item is tapped (flies to marker)
document.getElementById('top-list').addEventListener('click', () => {
  sidebar.classList.remove('mobile-open');
  drawerArrow.classList.remove('open');
});

// ─── LEGEND ────────────────────────────────────────────────────────────────────
const bar = document.getElementById('legend-bar');
for (let i = 0; i <= 31; i++) {
  const seg = document.createElement('div');
  seg.style.background = snowColor(i);
  bar.appendChild(seg);
}
</script>
</body>
</html>
